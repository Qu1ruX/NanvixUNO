<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.13">
  <compounddef id="hooks_8S" kind="file" language="C++">
    <compoundname>hooks.S</compoundname>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline><highlight class="normal">/*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Copyright(C)<sp/>2011-2016<sp/>Pedro<sp/>H.<sp/>Penna<sp/>&lt;pedrohenriquepenna@gmail.com&gt;</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>This<sp/>file<sp/>is<sp/>part<sp/>of<sp/>Nanvix.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Nanvix<sp/>is<sp/>free<sp/>software;<sp/>you<sp/>can<sp/>redistribute<sp/>it<sp/>and/or<sp/>modify</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>it<sp/>under<sp/>the<sp/>terms<sp/>of<sp/>the<sp/>GNU<sp/>General<sp/>Public<sp/>License<sp/>as<sp/>published<sp/>by</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>the<sp/>Free<sp/>Software<sp/>Foundation;<sp/>either<sp/>version<sp/>3<sp/>of<sp/>the<sp/>License,<sp/>or</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>(at<sp/>your<sp/>option)<sp/>any<sp/>later<sp/>version.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Nanvix<sp/>is<sp/>distributed<sp/>in<sp/>the<sp/>hope<sp/>that<sp/>it<sp/>will<sp/>be<sp/>useful,</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>but<sp/>WITHOUT<sp/>ANY<sp/>WARRANTY;<sp/>without<sp/>even<sp/>the<sp/>implied<sp/>warranty<sp/>of</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>MERCHANTABILITY<sp/>or<sp/>FITNESS<sp/>FOR<sp/>A<sp/>PARTICULAR<sp/>PURPOSE.<sp/><sp/>See<sp/>the</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>GNU<sp/>General<sp/>Public<sp/>License<sp/>for<sp/>more<sp/>details.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>You<sp/>should<sp/>have<sp/>received<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>GNU<sp/>General<sp/>Public<sp/>License</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>along<sp/>with<sp/>Nanvix.<sp/>If<sp/>not,<sp/>see<sp/>&lt;http://www.gnu.org/licenses/&gt;.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*<sp/>Must<sp/>come<sp/>first.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal">#define<sp/>_ASM_FILE_</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">#include<sp/>&lt;i386/i386.h&gt;</highlight></codeline>
<codeline><highlight class="normal">#include<sp/>&lt;i386/int.h&gt;</highlight></codeline>
<codeline><highlight class="normal">#include<sp/>&lt;nanvix/fs.h&gt;</highlight></codeline>
<codeline><highlight class="normal">#include<sp/>&lt;nanvix/pm.h&gt;</highlight></codeline>
<codeline><highlight class="normal">#include<sp/>&lt;nanvix/syscall.h&gt;</highlight></codeline>
<codeline><highlight class="normal">#include<sp/>&lt;signal.h&gt;</highlight></codeline>
<codeline><highlight class="normal">#include<sp/>&lt;errno.h&gt;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*<sp/>Exported<sp/>symbols.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint0</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint1</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint2</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint3</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint4</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint5</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint6</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint7</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint8</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint9</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint10</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint11</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint12</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint13</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint14</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint15</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint16</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>swint17</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>syscall</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>hwint0</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>hwint1</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>hwint2</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>hwint3</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>hwint4</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>hwint5</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>hwint6</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>hwint7</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>hwint8</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>hwint9</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>hwint10</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>hwint11</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>hwint12</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>hwint13</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>hwint14</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>hwint15</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>leave</highlight></codeline>
<codeline><highlight class="normal">.globl<sp/>do_hwint</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*----------------------------------------------------------------------------*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>save()<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*----------------------------------------------------------------------------*/</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Saves<sp/>registers.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">.macro<sp/>save</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%ecx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%ebx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%ebp</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%esi</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%edi</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Save<sp/>data<sp/>segment.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%ds</highlight></codeline>
<codeline><highlight class="normal">.endm</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*----------------------------------------------------------------------------*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enter()<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*----------------------------------------------------------------------------*/</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Enters<sp/>in<sp/>kernel.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">.macro<sp/>enter</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>movw<sp/>$KERNEL_DS,<sp/>%bx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>movw<sp/>%bx,<sp/>%ds</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>movl<sp/>curr_proc,<sp/>%ebx</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Increment<sp/>interrupt<sp/>level.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>incl<sp/>PROC_INTLVL(%ebx)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Save<sp/>interrupt<sp/>stack.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>PROC_KESP(%ebx)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>movl<sp/>%esp,<sp/>PROC_KESP(%ebx)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal">.endm</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*----------------------------------------------------------------------------*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>leave()<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*----------------------------------------------------------------------------*/</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Leaves<sp/>kernel.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">leave:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>movl<sp/>curr_proc,<sp/>%ebx</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Restore<sp/>interrupt<sp/>stack.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>popl<sp/>PROC_KESP(%ebx)</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Decrement<sp/>interrupt<sp/>level.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>decl<sp/>PROC_INTLVL(%ebx)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>jnz<sp/>leave.out</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Check<sp/>if<sp/>we<sp/>were<sp/>handling<sp/>a<sp/>system<sp/>call.<sp/>*/<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>btrl<sp/>$PROC_SYS,<sp/>PROC_FLAGS(%ebx)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>jnc<sp/>check_signals</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>The<sp/>kernel<sp/>is<sp/>non-preemptive.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>So,<sp/>let<sp/>us<sp/>be<sp/>nice<sp/>with<sp/>other<sp/>processes</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*<sp/>and<sp/>give<sp/>them<sp/>a<sp/>chance<sp/>to<sp/>run.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>call<sp/>yield</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>movl<sp/>curr_proc,<sp/>%ebx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Check<sp/>signals.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>check_signals:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bsfl<sp/>PROC_RECEIVED(%ebx),<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jz<sp/>leave.out</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>btrl<sp/>%eax,<sp/>PROC_RECEIVED(%ebx)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>PROC_HANDLERS(%ebx,<sp/>%eax,<sp/>4),<sp/>%ecx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cmpl<sp/>$_SIG_DFL,<sp/>%ecx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>je<sp/>default_signal</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cmpl<sp/>$_SIG_IGN,<sp/>%ecx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>je<sp/>check_signals</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>/*<sp/>User<sp/>signal.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>$_SIG_DFL,<sp/>PROC_HANDLERS(%ebx,<sp/>%eax,<sp/>4)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>PROC_RESTORER(%ebx),<sp/>%esi</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>USERESP<sp/>-<sp/>4(%esp),<sp/>%edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pushl<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pushl<sp/>%ecx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pushl<sp/>$MAY_WRITE</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pushl<sp/>$44</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pushl<sp/>%edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>call<sp/>chkmem</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>addl<sp/>$12,<sp/>%esp</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pop<sp/>%ecx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pop<sp/>%ebx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cmpl<sp/>$0,<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>je<sp/>leave.out</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>/*<sp/>Build<sp/>stack<sp/>for<sp/>signal<sp/>handler.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>USERESP<sp/>-<sp/>4(%esp),<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>EIP<sp/>-<sp/>4(%esp),<sp/>%edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>%edx,<sp/>-4(%eax)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>eip</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>EFLAGS<sp/>-<sp/>4(%esp),<sp/>%edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>%edx,<sp/>-8(%eax)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>eflags</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>EAX<sp/>-<sp/>4(%esp),<sp/>%edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>%edx,<sp/>-12(%eax)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>ECX<sp/>-<sp/>4(%esp),<sp/>%edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>%edx,<sp/>-16(%eax)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>ecx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>EDX<sp/>-<sp/>4(%esp),<sp/>%edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>%edx,<sp/>-20(%eax)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>EBX<sp/>-<sp/>4(%esp),<sp/>%edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>%edx,<sp/>-24(%eax)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>ebx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>EBP<sp/>-<sp/>4(%esp),<sp/>%edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>%edx,<sp/>-28(%eax)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>ebp</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>ESI<sp/>-<sp/>4(%esp),<sp/>%edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>%edx,<sp/>-32(%eax)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>esi</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>EDI<sp/>-<sp/>4(%esp),<sp/>%edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>%edx,<sp/>-36(%eax)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>edi</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>%ebx,<sp/>-40(%eax)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>Signal<sp/>number.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>%esi,<sp/>-44(%eax)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>#<sp/>Restorer<sp/>address.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>%ecx,<sp/>EIP<sp/>-<sp/>4(%esp)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>subl<sp/>$44,<sp/>USERESP<sp/>-<sp/>4(%esp)</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">leave.out:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>popl<sp/>%ds</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>popl<sp/>%edi</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>popl<sp/>%esi</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>popl<sp/>%ebp</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>popl<sp/>%ebx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>popl<sp/>%edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>popl<sp/>%ecx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>popl<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>iret</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">default_signal:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>cmpl<sp/>$SIGCHLD,<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>je<sp/>leave.out</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>call<sp/>*sigdfl(,<sp/>%eax,<sp/>4)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>addl<sp/>$4,<sp/>%esp</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>jmp<sp/>leave.out</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*----------------------------------------------------------------------------*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>swint()<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*----------------------------------------------------------------------------*/</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Software<sp/>interrupt<sp/>without<sp/>error<sp/>code.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">.macro<sp/>swint_noerr_code,<sp/>number,<sp/>handler</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>swint\()\number:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pushl<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>$0,<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pushl<sp/>%ecx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>$\handler,<sp/>%ecx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jmp<sp/>swint</highlight></codeline>
<codeline><highlight class="normal">.endm</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Software<sp/>interrupt<sp/>with<sp/>error<sp/>code.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">.macro<sp/>swint_err_code,<sp/>number,<sp/>handler</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>swint\()\number:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xchg<sp/>%eax,<sp/>(%esp)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pushl<sp/>%ecx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>$\handler,<sp/>%ecx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jmp<sp/>swint</highlight></codeline>
<codeline><highlight class="normal">.endm</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*<sp/>Software<sp/>interrupt<sp/>hooks.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal">swint_noerr_code<sp/><sp/>0<sp/>do_divide</highlight></codeline>
<codeline><highlight class="normal">swint_noerr_code<sp/><sp/>1<sp/>do_debug</highlight></codeline>
<codeline><highlight class="normal">swint_noerr_code<sp/><sp/>2<sp/>do_nmi</highlight></codeline>
<codeline><highlight class="normal">swint_noerr_code<sp/><sp/>3<sp/>do_breakpoint</highlight></codeline>
<codeline><highlight class="normal">swint_noerr_code<sp/><sp/>4<sp/>do_overflow</highlight></codeline>
<codeline><highlight class="normal">swint_noerr_code<sp/><sp/>5<sp/>do_bounds</highlight></codeline>
<codeline><highlight class="normal">swint_noerr_code<sp/><sp/>6<sp/>do_invalid_opcode</highlight></codeline>
<codeline><highlight class="normal">swint_noerr_code<sp/><sp/>7<sp/>do_coprocessor_not_available</highlight></codeline>
<codeline><highlight class="normal">swint_err_code<sp/><sp/><sp/><sp/>8<sp/>do_double_fault</highlight></codeline>
<codeline><highlight class="normal">swint_noerr_code<sp/><sp/>9<sp/>do_coprocessor_segment_overrun</highlight></codeline>
<codeline><highlight class="normal">swint_err_code<sp/><sp/><sp/>10<sp/>do_invalid_tss</highlight></codeline>
<codeline><highlight class="normal">swint_err_code<sp/><sp/><sp/>11<sp/>do_segment_not_present</highlight></codeline>
<codeline><highlight class="normal">swint_err_code<sp/><sp/><sp/>12<sp/>do_stack_exception</highlight></codeline>
<codeline><highlight class="normal">swint_err_code<sp/><sp/><sp/>13<sp/>do_general_protection</highlight></codeline>
<codeline><highlight class="normal">swint_err_code<sp/><sp/><sp/>14<sp/>_do_page_fault</highlight></codeline>
<codeline><highlight class="normal">swint_noerr_code<sp/>15<sp/>do_reserved</highlight></codeline>
<codeline><highlight class="normal">swint_noerr_code<sp/>16<sp/>do_coprocessor_error</highlight></codeline>
<codeline><highlight class="normal">swint_noerr_code<sp/>17<sp/>do_reserved</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Software<sp/>interrupt<sp/>handler<sp/>dispatcher.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">swint:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Save<sp/>registers.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%ebx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%ebp</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%esi</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%edi</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%ds</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>enter</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Leave<sp/>critical<sp/>region.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>sti</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Call<sp/>interrupt<sp/>handler.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>call<sp/>*%ecx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>add<sp/>$4,<sp/>%esp</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Enter<sp/>critical<sp/>region.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>cli</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>jmp<sp/>leave</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Page<sp/>fault<sp/>handler<sp/>wrapper.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">_do_page_fault:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>4(%esp)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>movl<sp/>%cr2,<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>pushl<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>call<sp/>do_page_fault</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>addl<sp/>$8,<sp/>%esp</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>ret</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*----------------------------------------------------------------------------*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>syscall()<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*----------------------------------------------------------------------------*/</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>System<sp/>call<sp/>hook.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">syscall:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>save</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>enter</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Set<sp/>&apos;handling<sp/>system<sp/>call&apos;<sp/>flag.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>btsl<sp/>$PROC_SYS,<sp/>PROC_FLAGS(%ebx)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Leave<sp/>critical<sp/>region.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>sti</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Get<sp/>system<sp/>call<sp/>parameters.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>movl<sp/>EAX(%esp),<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>movl<sp/>EBX(%esp),<sp/>%ebx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>movl<sp/>ECX(%esp),<sp/>%ecx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>movl<sp/>EDX(%esp),<sp/>%edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Check<sp/>for<sp/>bad<sp/>system<sp/>call.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>cmpl<sp/>$NR_SYSCALLS,<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>jl<sp/>good_syscall</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>$ENOSYS,<sp/>%eax<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>negl<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>jmp<sp/>bad_syscall</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>good_syscall:<sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>/*<sp/>Get<sp/>system<sp/>call.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>shl<sp/>$2,<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>addl<sp/>$syscalls_table,<sp/>%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movl<sp/>(%eax),<sp/>%eax</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>/*<sp/>Do<sp/>system<sp/>call.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pushl<sp/>%edx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pushl<sp/>%ecx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pushl<sp/>%ebx</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>call<sp/>*%eax</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>addl<sp/>$12,<sp/>%esp</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>bad_syscall:</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Copy<sp/>return<sp/>value<sp/>to<sp/>user<sp/>stack.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>movl<sp/>%eax,<sp/>EAX(%esp)</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>/*<sp/>Enter<sp/>critical<sp/>region.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>cli<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>jmp<sp/>leave</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*----------------------------------------------------------------------------*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>hwint()<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*----------------------------------------------------------------------------*/</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Master<sp/>hardware<sp/>interrupt.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">.macro<sp/>hwint_master,<sp/>num</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>hwint\()\num:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>save</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enter</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movb<sp/>$0x20,<sp/>%al</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>outb<sp/>%al,<sp/>$PIC_CTRL_MASTER<sp/>/*<sp/>Send<sp/>reset<sp/>signal<sp/>to<sp/>master.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pushl<sp/>$(\num)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>call<sp/>do_hwint</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>addl<sp/>$4,<sp/>%esp</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jmp<sp/>leave</highlight></codeline>
<codeline><highlight class="normal">.endm</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Slave<sp/>hardware<sp/>interrupt.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">.macro<sp/>hwint_slave,<sp/>num</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>hwint\()\num:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>save</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>enter</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>movb<sp/>$0x20,<sp/>%al</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>outb<sp/>%al,<sp/>$PIC_CTRL_MASTER<sp/>/*<sp/>Send<sp/>reset<sp/>signal<sp/>to<sp/>master.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>outb<sp/>%al,<sp/>$PIC_CTRL_SLAVE<sp/><sp/>/*<sp/>Send<sp/>reset<sp/>signal<sp/>to<sp/>slave.<sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pushl<sp/>$(\num)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>call<sp/>do_hwint</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>addl<sp/>$4,<sp/>%esp</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>jmp<sp/>leave</highlight></codeline>
<codeline><highlight class="normal">.endm</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/*<sp/>Hardware<sp/>interrupt<sp/>hooks.<sp/>*/</highlight></codeline>
<codeline><highlight class="normal">hwint_master<sp/>0</highlight></codeline>
<codeline><highlight class="normal">hwint_master<sp/>1</highlight></codeline>
<codeline><highlight class="normal">hwint_master<sp/>2</highlight></codeline>
<codeline><highlight class="normal">hwint_master<sp/>3</highlight></codeline>
<codeline><highlight class="normal">hwint_master<sp/>4</highlight></codeline>
<codeline><highlight class="normal">hwint_master<sp/>5</highlight></codeline>
<codeline><highlight class="normal">hwint_master<sp/>6</highlight></codeline>
<codeline><highlight class="normal">hwint_master<sp/>7</highlight></codeline>
<codeline><highlight class="normal">hwint_slave<sp/><sp/>8</highlight></codeline>
<codeline><highlight class="normal">hwint_slave<sp/><sp/>9</highlight></codeline>
<codeline><highlight class="normal">hwint_slave<sp/>10</highlight></codeline>
<codeline><highlight class="normal">hwint_slave<sp/>11</highlight></codeline>
<codeline><highlight class="normal">hwint_slave<sp/>12</highlight></codeline>
<codeline><highlight class="normal">hwint_slave<sp/>13</highlight></codeline>
<codeline><highlight class="normal">hwint_slave<sp/>14</highlight></codeline>
<codeline><highlight class="normal">hwint_slave<sp/>15</highlight></codeline>
    </programlisting>
    <location file="src/kernel/arch/x86/hooks.S"/>
  </compounddef>
</doxygen>
